<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  
  <!-- å¾®ä¿¡ / æŠ–éŸ³åˆ†äº«å…³é”® Meta - æ³¨æ„ï¼šéƒ¨ç½²åæ›¿æ¢ og:url å’Œ og:image -->
  <title>æŠŠçˆ±å¸¦å›å®¶ | ä¸“å±ç¥ç¦</title>
  <meta name="description" content="è¿™æ˜¯æˆ‘é€ä½ çš„ç¥ç¦ï¼Œæ„¿æ¸©æš–å¸¸ä¼´ï¼Œå¹¸ç¦å®‰åº·ï¼ç‚¹å‡»æ‰“å¼€ä¸“å±è´ºå¡ >>" />
  <meta property="og:title" content="æŠŠçˆ±å¸¦å›å®¶ | ä¸“å±ç¥ç¦" />
  <meta property="og:description" content="è¿™æ˜¯æˆ‘é€ä½ çš„ç¥ç¦ï¼Œæ„¿æ¸©æš–å¸¸ä¼´ï¼Œå¹¸ç¦å®‰åº·ï¼ç‚¹å‡»æ‰“å¼€ä¸“å±è´ºå¡ >>" />
  <meta property="og:image" content="
https://tupian2026.oss-cn-shenzhen.aliyuncs.com/%E6%84%9F%E6%81%A9%E6%9C%89%E4%BD%A0.png" />
  <meta property="og:url" content="https://yourdomain.com/gratitude-card.html" />
  <meta property="og:type" content="website" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #ff7e5f, #feb47b);
      font-family: "åæ–‡è¡Œæ¥·", "STXingkai", "KaiTi", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "SimHei", cursive, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px;
      overflow-x: hidden;
      position: relative;
      color: white;
    }

    /* é£˜è½åŠ¨ç”»å®¹å™¨ */
    #snow-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }
    .snow {
      position: absolute;
      color: #ffd700;
      font-size: 24px;
      opacity: 0.8;
      text-shadow: 0 0 8px rgba(255,215,0,0.6);
      animation: fall linear forwards;
    }

    @keyframes fall {
      to { transform: translateY(100%) rotate(360deg); }
    }

    .container {
      max-width: 600px;
      width: 100%;
      z-index: 2;
    }

    .form-area {
      background: rgba(255, 255, 255, 0.92);
      padding: clamp(15px, 5vw, 25px);
      border-radius: 20px;
      box-shadow: 0 8px 25px rgba(192, 57, 43, 0.4);
      margin-bottom: 25px;
      backdrop-filter: blur(5px);
    }
    .form-area h2 {
      text-align: center;
      color: #c0392b;
      margin-bottom: 20px;
      font-size: clamp(24px, 6vw, 28px);
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    textarea, input {
      width: 100%;
      padding: clamp(10px, 3vw, 14px);
      margin: 12px 0;
      border: 2px solid #e74c3c;
      border-radius: 12px;
      font-size: clamp(16px, 4vw, 18px);
      font-family: inherit;
      outline: none;
      resize: none;
    }
    button {
      width: 100%;
      padding: clamp(12px, 4vw, 16px);
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
      border: none;
      border-radius: 14px;
      font-size: clamp(18px, 5vw, 20px);
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
      box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
      transition: all 0.3s ease;
    }
    button:hover { transform: scale(1.02); }
    button:active { transform: scale(0.98); }

    .card-view {
      display: none;
      width: 100%;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(192, 57, 43, 0.35);
      position: relative;
      aspect-ratio: 9 / 16;
      max-height: 85vh;
      animation: fadeIn 0.8s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .card-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://i.imgur.com/KMCyiBY.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.95;
    }
    .card-content {
      position: relative;
      z-index: 2;
      padding: clamp(20px, 8vw, 30px);
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: #fff;
      text-shadow: 0 2px 8px rgba(0,0,0,0.6);
    }
    .card-title {
      font-size: clamp(32px, 12vw, 48px);
      margin-bottom: 30px;
      letter-spacing: 8px;
      animation: pulse 2s infinite, shine 3s ease-in-out infinite alternate;
      white-space: nowrap;
      overflow: hidden;
      font-weight: bold;
      background: linear-gradient(135deg, #ffd700, #ff9a76, #ff6b6b);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      -webkit-text-stroke: 1px rgba(255,255,255,0.8);
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    @keyframes shine {
      from { filter: drop-shadow(0 0 10px rgba(255,215,0,0.4)); }
      to { filter: drop-shadow(0 0 20px rgba(255,154,118,0.8)); }
    }
    .card-message {
      font-size: clamp(18px, 5vw, 24px);
      line-height: 2;
      margin-bottom: 25px;
      background: rgba(0,0,0,0.25);
      padding: clamp(15px, 5vw, 20px);
      border-radius: 16px;
      width: 100%;
      backdrop-filter: blur(8px);
      max-height: 40%;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overflow: hidden;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .char-animate {
      opacity: 0;
      transform: translateY(10px);
      animation: charFadeIn 0.5s ease forwards;
      display: inline-block;
    }
    @keyframes charFadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .card-sender {
      font-size: clamp(18px, 4.5vw, 22px);
      margin-top: auto;
      animation: fadeIn 1.5s ease-out;
      padding: 10px 20px;
      background: rgba(255,107,107,0.2);
      border-radius: 12px;
      backdrop-filter: blur(5px);
    }

    #loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: clamp(18px, 4vw, 20px);
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: all 0.3s ease;
      flex-direction: column;
    }
    #loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 3px solid #fff;
      border-top: 3px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-top: 15px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="snow-container"></div>

  <div class="container">
    <div id="formSection" class="form-area">
      <h2>âœ¨ å†™ä¸‹ä½ çš„ç¥ç¦</h2>
      <textarea id="message" placeholder="å†™ä¸‹ä½ æƒ³è¯´çš„è¯...ï¼ˆæœ€å¤š50å­—ï¼Œä¾‹å¦‚ï¼šæ„¿ä½ å¹³å®‰å–œä¹ï¼Œä¸‡äº‹é¡ºé‚ï¼ï¼‰" rows="3"></textarea>
      <input type="text" id="name" placeholder="ä½ çš„åå­—ï¼ˆæœ€å¤š8å­—ï¼‰" />
      <button id="createCardBtn">ğŸ ç”Ÿæˆæˆ‘çš„ç¥ç¦å¡</button>
    </div>

    <div id="cardSection" class="card-view">
      <div class="card-bg"></div>
      <div class="card-content">
        <div class="card-title">æŠŠçˆ±å¸¦å›å®¶</div>
        <div class="card-message" id="displayMessage">æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…ï¼Œå¹¸ç¦å¸¸ä¼´ã€‚</div>
        <div class="card-sender" id="displayName">â€”â€” æ¥è‡ªï¼šæœ‹å‹</div>
        
        <!-- ä¿å­˜æŒ‰é’®ä¿ç•™ -->
        <div style="margin-top: 20px;">
          <button id="saveBtn" style="
            background: linear-gradient(135deg, #ffd700, #ff9a76);
            color: #c0392b;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255,215,0,0.4);
            transition: transform 0.2s;
          ">ğŸ’¾ ä¿å­˜è´ºå¡åˆ°ç›¸å†Œ</button>
        </div>
      </div>
    </div>
  </div>

  <div id="loading">ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™</div>

  <script>
    const CONSTANTS = {
      SNOW_INTERVAL: 600,
      SNOW_DURATION: 10000,
      LOADING_DELAY: 800,
      MAX_MSG_LENGTH: 50,
      MAX_NAME_LENGTH: 8,
      SNOW_SYMBOLS: ['â¤ï¸', 'âœ¨', 'ğŸ•Šï¸', 'ğŸŒ¸', 'ğŸ’«', 'ğŸ’Œ', 'ğŸŒŸ'],
      DEFAULT_MSG: 'æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…ï¼Œå¹¸ç¦å¸¸ä¼´ã€‚',
      DEFAULT_NAME: 'æœ‹å‹',
      CHAR_DELAY: 80,
      BG_IMAGE_URL: 'https://i.imgur.com/KMCyiBY.png'
    };

    let snowTimer = null;

    function createSnow() {
      const container = document.getElementById('snow-container');
      const maxSnowCount = 20;
      snowTimer = setInterval(() => {
        if (container.children.length >= maxSnowCount) return;
        const snow = document.createElement('div');
        snow.classList.add('snow');
        snow.innerText = CONSTANTS.SNOW_SYMBOLS[Math.floor(Math.random() * CONSTANTS.SNOW_SYMBOLS.length)];
        snow.style.left = `${Math.random() * 100}vw`;
        snow.style.opacity = `${Math.random() * 0.5 + 0.5}`;
        snow.style.fontSize = `${Math.random() * 20 + 16}px`;
        snow.style.animationDuration = `${Math.random() * 5 + 5}s`;
        snow.style.transform = `rotate(${Math.random() * 360}deg)`;
        container.appendChild(snow);
        setTimeout(() => snow.remove(), CONSTANTS.SNOW_DURATION);
      }, CONSTANTS.SNOW_INTERVAL);
    }

    function initTextAnimate(text, container) {
      container.innerHTML = '';
      const chars = text.split('');
      chars.forEach((char, index) => {
        const span = document.createElement('span');
        span.className = 'char-animate';
        span.innerText = char;
        span.style.animationDelay = `${index * CONSTANTS.CHAR_DELAY}ms`;
        container.appendChild(span);
      });
    }

    async function generateCardImage(message, senderName) {
      return new Promise((resolve, reject) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const width = 1080;
        const height = 1920;
        canvas.width = width;
        canvas.height = height;

        const bgImg = new Image();
        bgImg.crossOrigin = "anonymous";
        bgImg.src = CONSTANTS.BG_IMAGE_URL;
        
        bgImg.onload = () => {
          ctx.drawImage(bgImg, 0, 0, width, height);
          
          // æ ‡é¢˜
          ctx.font = 'bold 120px "åæ–‡è¡Œæ¥·", "STXingkai", cursive, sans-serif';
          ctx.textAlign = 'center';
          ctx.fillStyle = '#ffd700';
          ctx.strokeStyle = 'rgba(255,255,255,0.8)';
          ctx.lineWidth = 3;
          ctx.strokeText('æŠŠçˆ±å¸¦å›å®¶', width / 2, 400);
          ctx.fillText('æŠŠçˆ±å¸¦å›å®¶', width / 2, 400);
          
          // ç¥ç¦è¯­ï¼ˆè‡ªåŠ¨æ¢è¡Œï¼‰
          ctx.font = '48px "KaiTi", cursive, sans-serif';
          ctx.fillStyle = 'white';
          wrapText(ctx, message, width / 2, 600, 900, 60);
          
          // å‘é€è€…
          ctx.font = '42px "PingFang SC", sans-serif';
          ctx.fillStyle = 'rgba(255,255,255,0.9)';
          ctx.fillText(`â€”â€” æ¥è‡ªï¼š${senderName}`, width / 2, height - 200);
          
          resolve(canvas.toDataURL('image/png'));
        };
        
        bgImg.onerror = () => reject(new Error('èƒŒæ™¯å›¾åŠ è½½å¤±è´¥'));
      });
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
      const words = text.split('');
      let line = '';
      let currentY = y;
      for (let n = 0; n < words.length; n++) {
        let testLine = line + words[n];
        let metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && n > 0) {
          ctx.fillText(line, x, currentY);
          line = words[n];
          currentY += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line, x, currentY);
    }

    async function handleSaveClick() {
      const msgEl = document.getElementById('displayMessage');
      const nameEl = document.getElementById('displayName');
      const msg = msgEl.textContent.trim();
      const name = nameEl.textContent.replace('â€”â€” æ¥è‡ªï¼š', '').trim();
      
      try {
        const loading = document.getElementById('loading');
        loading.innerText = 'æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...';
        loading.style.display = 'flex';

        const imgUrl = await generateCardImage(msg, name);
        
        const preview = document.createElement('div');
        preview.style.cssText = `
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          background: rgba(0,0,0,0.9);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          z-index: 2000;
          padding: 20px;
        `;
        
        const img = document.createElement('img');
        img.src = imgUrl;
        img.style.cssText = `
          max-width: 90%;
          max-height: 80%;
          border-radius: 12px;
          box-shadow: 0 0 30px rgba(255,215,0,0.6);
        `;
        
        // åˆ æ‰äº†é¢„è§ˆå›¾ä¸‹æ–¹çš„é•¿æŒ‰ä¿å­˜æç¤ºtip
        const closeBtn = document.createElement('div');
        closeBtn.innerText = 'Ã— å…³é—­';
        closeBtn.style.cssText = `
          color: #ffd700;
          margin-top: 20px;
          font-size: 20px;
          cursor: pointer;
        `;
        closeBtn.onclick = () => document.body.removeChild(preview);
        
        preview.appendChild(img);
        preview.appendChild(closeBtn);
        document.body.appendChild(preview);
        
        loading.style.display = 'none';
      } catch (e) {
        console.error('ç”Ÿæˆå¤±è´¥', e);
        alert('å›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        document.getElementById('loading').style.display = 'none';
      }
    }

    function createCard() {
      const msgInput = document.getElementById('message');
      const nameInput = document.getElementById('name');
      const msg = msgInput.value.trim();
      const name = nameInput.value.trim();
      const messageContainer = document.getElementById('displayMessage');
      
      if (!msg) { alert('è¯·å†™ä¸‹ä½ çš„ç¥ç¦è¯è¯­ï½'); msgInput.focus(); return; }
      if (!name) { alert('è¯·å¡«å†™ä½ çš„åå­—ï½'); nameInput.focus(); return; }
      if (msg.length > CONSTANTS.MAX_MSG_LENGTH) { alert(`ç¥ç¦è¯­æœ€å¤š${CONSTANTS.MAX_MSG_LENGTH}å­—å“¦ï½`); msgInput.focus(); return; }
      if (name.length > CONSTANTS.MAX_NAME_LENGTH) { alert(`åå­—æœ€å¤š${CONSTANTS.MAX_NAME_LENGTH}å­—å“¦ï½`); nameInput.focus(); return; }

      const loading = document.getElementById('loading');
      loading.style.display = 'flex';
      loading.innerText = 'ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™';

      setTimeout(() => {
        document.getElementById('displayName').innerText = `â€”â€” æ¥è‡ªï¼š${name}`;
        initTextAnimate(msg, messageContainer);
        document.getElementById('formSection').style.display = 'none';
        document.getElementById('cardSection').style.display = 'block';
        // åˆ æ‰äº†åˆ†äº«æç¤ºæ¡çš„æ˜¾ç¤ºä»£ç 

        const newUrl = `${window.location.origin}${window.location.pathname}?msg=${encodeURIComponent(msg)}&name=${encodeURIComponent(name)}`;
        window.history.replaceState({}, '', newUrl);
        loading.style.display = 'none';
      }, CONSTANTS.LOADING_DELAY);
    }

    window.onload = () => {
      createSnow();
      document.getElementById('createCardBtn').addEventListener('click', createCard);
      document.getElementById('name').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') createCard();
      });

      // åŠ¨æ€ç›‘å¬ä¿å­˜æŒ‰é’®ç‚¹å‡»ï¼ˆå› æŒ‰é’®åˆå§‹éšè—ï¼‰
      document.addEventListener('click', (e) => {
        if (e.target.id === 'saveBtn') {
          handleSaveClick();
        }
      });

      const urlParams = new URLSearchParams(window.location.search);
      const msg = urlParams.get('msg');
      const name = urlParams.get('name');
      const messageContainer = document.getElementById('displayMessage');
      if (msg && name) {
        try {
          const decodeMsg = decodeURIComponent(msg);
          const decodeName = decodeURIComponent(name);
          initTextAnimate(decodeMsg, messageContainer);
          document.getElementById('displayName').innerText = `â€”â€” æ¥è‡ªï¼š${decodeName}`;
          document.getElementById('formSection').style.display = 'none';
          document.getElementById('cardSection').style.display = 'block';
          // åˆ æ‰äº†åˆ†äº«æç¤ºæ¡çš„æ˜¾ç¤ºä»£ç 
        } catch (e) {
          initTextAnimate(CONSTANTS.DEFAULT_MSG, messageContainer);
        }
      } else {
        initTextAnimate(CONSTANTS.DEFAULT_MSG, messageContainer);
      }
    };

    window.onunload = () => {
      if (snowTimer) clearInterval(snowTimer);
    };
  </script>
</body>
</html>